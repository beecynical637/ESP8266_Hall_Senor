# ESP8266 Hall Sensor RPM Counter with Web Interface

Этот проект представляет собой программное обеспечение для микроконтроллера ESP8266, реализующее счётчик оборотов (RPM) на основе датчика Холла с отображением информации через веб-интерфейс. Проект ориентирован на начинающих и преподавателей технических дисциплин, которым требуется простой пример работы с ESP8266, веб-сервером и обработкой сигналов от датчика Холла.

## Описание

Прошивка позволяет считать количество оборотов в минуту (RPM) с помощью датчика Холла, подключённого к ESP8266, и отображать результат на встроенной веб-странице. Веб-интерфейс прост для понимания и подходит для использования в учебных целях.

**Ключевые возможности:**
- Подсчёт оборотов с помощью датчика Холла
- Поддержка ESP8266 (например, NodeMCU, Wemos D1 Mini)
- Встроенный HTTP веб-сервер для отображения текущих показателей RPM
- Обновление значений RPM в реальном времени

## Структура проекта

```
ESP8266_Hall_Senor/
│   platformio.ini          # Конфигурация PlatformIO
│   README.md              # Этот файл
│   
├───include/
│       README             # Описание папки include
│       wifi_credentials.h         # Настройки Wi-Fi (не добавлять в git!)
│       wifi_credentials.h.example # Шаблон для настроек Wi-Fi
│       
├───lib/
│       README             # Описание папки lib
│
├───src/
│       main.cpp           # Основной код прошивки
│
└───test/
        README             # Описание папки test
```

## Аппаратные требования

- **ESP8266** (NodeMCU, Wemos D1 Mini или аналогичная плата)
- **Датчик Холла** (A3144, SS49E, OH49E или аналогичный) - 2 шт.
- **Дисплей TM1637** (4-разрядный 7-сегментный) - 2 шт.
- **Соединительные провода** (dupont или breadboard провода)
- **USB кабель** для программирования ESP8266
- **Breadboard** (макетная плата) - опционально, для удобства сборки

## Полная схема подключения

### Расположение пинов на NodeMCU v1.0:
```
                    ESP8266 NodeMCU
                ┌─────────────────────┐
                │                     │
             A0 │ •                 • │ D0
             G  │ •                 • │ D1  <- CLK дисплея 1
             VV │ •                 • │ D2  <- DIO дисплея 1
             S3 │ •                 • │ D3  <- CLK дисплея 2
             S2 │ •                 • │ D4  <- DIO дисплея 2
             S1 │ •                 • │ 3V
             SC │ •                 • │ G
             S0 │ •                 • │ D5  <- Датчик Холла 1
             SK │ •                 • │ D6  <- Датчик Холла 2
             SD │ •                 • │ D7
             CMD│ •                 • │ D8
                │      [USB]          │
             3V │ •                 • │ RX
      VCC -> G  │ •                 • │ TX
             EN │ •                 • │ G
             RST│ •                 • │ G   
      GND -> VIN│ •                 • │ 3V  
                │                     │
                └─────────────────────┘
```

### Схема подключения дисплеев TM1637

**Первый дисплей (для датчика 1):**
```
ESP8266 NodeMCU          Дисплей TM1637 #1
┌─────────────────┐      ┌─────────────────┐
│                 │      │                 │
│    3V3 (3.3V) ──┼──────┼── VCC           │
│                 │      │                 │
│    GND ─────────┼──────┼── GND           │
│                 │      │                 │
│    D1 (GPIO5) ──┼──────┼── CLK           │
│                 │      │                 │
│    D2 (GPIO4) ──┼──────┼── DIO           │
│                 │      │                 │
└─────────────────┘      └─────────────────┘
```

**Второй дисплей (для датчика 2):**
```
ESP8266 NodeMCU          Дисплей TM1637 #2
┌─────────────────┐      ┌─────────────────┐
│                 │      │                 │
│    3V3 (3.3V) ──┼──────┼── VCC           │
│                 │      │                 │
│    GND ─────────┼──────┼── GND           │
│                 │      │                 │
│    D3 (GPIO0) ──┼──────┼── CLK           │
│                 │      │                 │
│    D4 (GPIO2) ──┼──────┼── DIO           │
│                 │      │                 │
└─────────────────┘      └─────────────────┘
```

### Схема подключения датчиков Холла

**Первый датчик Холла A3144 (для дисплея 1):**
```
ESP8266 NodeMCU          Датчик Холла A3144 #1
┌─────────────────┐      ┌─────────────────┐
│                 │      │                 │
│    3V3 (3.3V) ──┼──────┼── VCC           │
│                 │      │                 │
│    GND ─────────┼──────┼── GND           │
│                 │      │                 │
│    D5 (GPIO14) ─┼──────┼── OUT           │
│                 │      │                 │
└─────────────────┘      └─────────────────┘
```

**Второй датчик Холла A3144 (для дисплея 2):**
```
ESP8266 NodeMCU          Датчик Холла A3144 #2
┌─────────────────┐      ┌─────────────────┐
│                 │      │                 │
│    3V3 (3.3V) ──┼──────┼── VCC           │
│                 │      │                 │
│    GND ─────────┼──────┼── GND           │
│                 │      │                 │
│    D6 (GPIO12) ─┼──────┼── OUT           │
│                 │      │                 │
└─────────────────┘      └─────────────────┘
```

### Сводная таблица подключений:

| Компонент | Пин ESP8266 | Описание |
|-----------|-------------|----------|
| **Дисплей 1** | | |
| TM1637 CLK1 | D1 (GPIO5) | Тактовый сигнал дисплея 1 |
| TM1637 DIO1 | D2 (GPIO4) | Данные дисплея 1 |
| **Дисплей 2** | | |
| TM1637 CLK2 | D3 (GPIO0) | Тактовый сигнал дисплея 2 |
| TM1637 DIO2 | D4 (GPIO2) | Данные дисплея 2 |
| **Датчики Холла** | | |
| Hall Sensor 1 | D5 (GPIO14) | Выход датчика Холла 1 |
| Hall Sensor 2 | D6 (GPIO12) | Выход датчика Холла 2 |
| **Питание** | | |
| VCC (все компоненты) | 3V3 | Питание +3.3V |
| GND (все компоненты) | GND | Общая земля |

### Подключение магнитов:
- Магниты должны находиться на расстоянии 1-10 мм от соответствующих датчиков Холла
- При вращении объектов магниты должны периодически приближаться к датчикам
- Датчики срабатывают при приближении южного полюса магнита (для A3144)

## Установка среды разработки

### Шаг 1: Установка Visual Studio Code
1. Перейдите на [официальный сайт VS Code](https://code.visualstudio.com/)
2. Скачайте версию для вашей операционной системы
3. Запустите установщик и следуйте инструкциям

### Шаг 2: Установка PlatformIO
1. Откройте VS Code
2. Нажмите **Ctrl+Shift+X** (или перейдите в Extensions на боковой панели)
3. В поле поиска введите: `PlatformIO IDE`
4. Найдите расширение "PlatformIO IDE" от PlatformIO
5. Нажмите **Install**
6. Дождитесь завершения установки (может занять несколько минут)
7. Перезапустите VS Code

### Шаг 3: Получение проекта

**Вариант А: Загрузка ZIP-архива (для тех, у кого нет Git)**
1. Перейдите на [страницу репозитория](https://github.com/beecynical637/ESP8266_Hall_Senor)
2. Нажмите зелёную кнопку **Code**
3. Выберите **Download ZIP**
4. Распакуйте архив в удобную папку
5. В VS Code: **File → Open Folder** → выберите распакованную папку

**Вариант Б: Клонирование через Git (если Git установлен)**
```bash
git clone https://github.com/beecynical637/ESP8266_Hall_Senor.git
```

## Настройка Wi-Fi подключения

### Создание файла конфигурации:
1. Откройте папку проекта в VS Code
2. Перейдите в папку `include/`
3. Найдите файл `wifi_credentials.h.example`
4. **Скопируйте** этот файл в той же папке
5. **Переименуйте** копию в `wifi_credentials.h`

### Редактирование настроек Wi-Fi:
1. Откройте файл `include/wifi_credentials.h`
2. Найдите строки:
   ```cpp
   const char* ssid = "YOUR_WIFI_SSID";
   const char* password = "YOUR_WIFI_PASSWORD";
   ```
3. Замените на ваши данные:
   ```cpp
   const char* ssid = "МояWiFiСеть";           // Имя вашей Wi-Fi сети
   const char* password = "МойПарольWiFi";     // Пароль от Wi-Fi
   ```
4. Сохраните файл (**Ctrl+S**)

**Важно:** 
- Используйте точное имя сети (регистр имеет значение)
- ESP8266 поддерживает только сети 2.4 ГГц (не 5 ГГц)

## Компиляция и загрузка прошивки

### Подготовка:
1. Подключите ESP8266 к компьютеру через USB кабель
2. Убедитесь, что драйверы установлены (обычно устанавливаются автоматически)

### Загрузка через PlatformIO:
1. Откройте проект в VS Code
2. Найдите иконку PlatformIO на левой боковой панели (иконка "головы муравья")
3. Нажмите на неё, откроется панель PlatformIO
4. В разделе "PROJECT TASKS" найдите ваш проект
5. Разверните "env:nodemcuv2" (или соответствующую среду)
6. Нажмите **"Upload"**

**Альтернативные способы загрузки:**
- Горячие клавиши: **Ctrl+Alt+U**
- Через командную палитру: **Ctrl+Shift+P** → "PlatformIO: Upload"
- Через панель внизу: кнопка со стрелкой вправо

### Отслеживание процесса:
В нижней части VS Code появится терминал с информацией о компиляции и загрузке:
```
Building .pio/build/nodemcuv2/src/main.cpp.o
Linking .pio/build/nodemcuv2/firmware.elf
Building .pio/build/nodemcuv2/firmware.bin
Uploading .pio/build/nodemcuv2/firmware.bin
...
Writing at 0x00000000... (100 %)
Wrote 261136 bytes (189516 compressed) at 0x00000000 in 16.7 seconds
Hash of data verified.
```

## Использование

### Проверка подключения:
1. После загрузки откройте Serial Monitor:
   - **Ctrl+Shift+P** → "PlatformIO: Serial Monitor"
   - Или через панель PlatformIO → "Monitor"
2. Установите скорость **115200 baud**
3. Вы увидите процесс подключения к Wi-Fi:
   ```
   Connecting to WiFi...
   WiFi connected!
   IP address: 192.168.1.100
   Web server started
   ```

### Проверка дисплеев:
1. После успешной загрузки прошивки оба дисплея TM1637 должны показывать "0"
2. При вращении магнитов возле датчиков Холла значения RPM должны обновляться на соответствующих дисплеях
3. Дисплей 1 показывает RPM от датчика 1 (D5)
4. Дисплей 2 показывает RPM от датчика 2 (D6)

### Доступ к веб-интерфейсу:
1. Скопируйте IP-адрес из Serial Monitor
2. Откройте браузер на любом устройстве в той же сети
3. Введите IP-адрес в адресную строку
4. Нажмите Enter - откроется страница с показаниями RPM от обоих датчиков

### Тестирование датчиков:
1. Поднесите магниты к соответствующим датчикам Холла
2. Медленно вращайте магниты или перемещайте их туда-сюда
3. В Serial Monitor должны появляться сообщения о срабатывании обоих датчиков
4. На дисплеях и веб-странице должны обновляться значения RPM в реальном времени для каждого датчика отдельно

## Возможные проблемы и решения

### ESP8266 не подключается к Wi-Fi:
- **Проверьте настройки:** убедитесь, что SSID и пароль в `wifi_credentials.h` введены правильно
- **Частота сети:** ESP8266 работает только с 2.4 ГГц сетями (не 5 ГГц)
- **Расстояние:** поднесите ESP8266 ближе к роутеру
- **Перезагрузка:** нажмите кнопку RESET на ESP8266

### Дисплеи TM1637 не работают:
- **Проверьте подключение:** убедитесь, что CLK и DIO провода подключены правильно
- **Питание:** проверьте подачу 3.3V на VCC и подключение GND
- **Качество соединения:** убедитесь в надёжности контактов
- **Совместимость дисплея:** некоторые дисплеи могут требовать 5V питания

### Не считаются обороты:
- **Проверьте подключение датчиков:** убедитесь, что провода подключены правильно к пинам D5 и D6
- **Тестируйте датчики:** подключите мультиметр к выходам датчиков - напряжение должно изменяться при приближении магнитов
- **Сила магнитов:** используйте более сильные магниты или поднесите ближе (1-5 мм)
- **Полярность:** попробуйте перевернуть магниты (некоторые датчики реагируют на определённый полюс)

### Не удается загрузить прошивку:
- **Порт:** убедитесь, что ESP8266 определился в системе (Диспетчер устройств в Windows)
- **Драйверы:** установите драйверы для CH340 или CP2102 (зависит от платы)
- **USB кабель:** используйте кабель с поддержкой передачи данных (не только зарядки)
- **Кнопка BOOT:** на некоторых платах нужно удерживать кнопку BOOT/FLASH во время загрузки

### Проблемы с компиляцией:
- **Обновите PlatformIO:** Tools → PlatformIO → Update All
- **Очистите проект:** PlatformIO → Clean
- **Проверьте platformio.ini:** убедитесь, что файл не повреждён
- **Библиотека TM1637:** убедитесь, что библиотека TM1637Display установлена

## Дополнительная информация

### Характеристики дисплея TM1637:
- Напряжение питания: 3.3V - 5V
- Количество разрядов: 4
- Тип: 7-сегментный светодиодный
- Интерфейс: 2-проводной (CLK + DIO)
- Яркость: регулируемая (8 уровней)

### Характеристики датчика A3144:
- Напряжение питания: 4.5-24V (работает от 3.3V)
- Выходной ток: до 25 мА
- Температурный диапазон: -40°C до +85°C
- Чувствительность: ~35 Гаусс

### Настройка для других датчиков:
Если используете другой датчик Холла, возможно потребуется изменить логику в коде:
- **Аналоговые датчики** (например, SS49E): требуют подключения к аналоговому пину A0
- **Цифровые датчики с обратной логикой**: может потребоваться инвертировать сигнал в коде

## Лицензия

Проект распространяется под лицензией MIT. Используйте и модифицируйте для образовательных целей!